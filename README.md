# Setup on macOS: (1st draft not to forget)

```
curl https://nixos.org/nix/install | sh
```

Most builds require x86_64 gnu_linux....

(check for later version) https://github.com/nix-community/linuxkit-nix
```
nix-env -i /nix/store/jgq3savsyyrpsxvjlrz41nx09z7r0lch-linuxkit-builder
```

copy into local ssh config (won't be necessary in later versions of linuxkit
```
sudo nvim /var/root/.ssh/nix-linuxkit-ssh-config
```

```
nix-linuxkit-configure
```

if this fails....
```
ssh root@nix-linuxkit 
```

then
```
rm -rf ~/.cache/nix-linuxkit-builder
nix-linuxkit-configure
```

zshrc:
generated by linuxkit, will point local builds to its vm
```
export NIX_REMOTE_SYSTEMS="/etc/nix/machines"
```
generated by nix:
```
if [ -e $HOME/.nix-profile/etc/profile.d/nix.sh ]; then . $HOME/.nix-profile/etc/profile.d/nix.sh; fi # added by Nix installer
```
```
export DIGITAL_OCEAN_AUTH_TOKEN='your-auth-token'
```

(currently you need the unstable branch for default channel of 19.03)
```
nix-env -i nixops
cd do
echo '[ "your-ssh-key" ]' > adc-public-key.nix # not certain this is necessary

nixops create ./adc-server.nix -d adc-server
./setup
```

In event of issues connecting to do ssh right after droplet creation, reboot (I haven't yet found root cause).
